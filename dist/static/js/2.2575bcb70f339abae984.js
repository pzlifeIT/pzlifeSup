webpackJsonp([2],{174:function(e,t,a){a(235);var r=a(77)(a(219),a(245),"data-v-289756e5",null);e.exports=r.exports},184:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:["num","image"],data:function(){return{imaegUrl:""}},watch:{image:function(e){this.imaegUrl=this.image}},mounted:function(){this.imaegUrl=this.image},methods:{fileShow:function(){document.querySelector("#fileinp"+this.num).click()},fileChange:function(e){var t=e.target.files||e.dataTransfer.files,a=this;a.imageDeal(t[0],function(e){a.uploadfile(e)})},uploadfile:function(e){var t=this,a=new FormData;a.append("image",e),t.$request({data:a,url:"upload/uploadfile",success:function(e){console.log(t.num),t.imaegUrl=e.image_path||"",t.$emit("upresult",{image_path:e.image_path,num:t.num})},complete:function(e){document.querySelector("#fileinp"+t.num).value=""},error:function(){t.$emit("upresult",{num:t.num})}})},imageDeal:function(e,t){var a=this,r=e;if(void 0!=r){if(r.size<=1048576)return void t(r);var i=new FileReader;i.readAsDataURL(r),i.onload=function(e){var r=e.target.result;console.log("压缩前："+r.length),a.suofang(r,1.5,t)}}},suofang:function(e){function t(t,a,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,a){console.log("执行缩放程序,bili="+t);var r=new Image,i=this;r.src=e,r.onload=function(){var e=document.createElement("canvas"),r=this.width/t,s=this.height/t;e.setAttribute("width",r),e.setAttribute("height",s),e.getContext("2d").drawImage(this,0,0,r,s);var o=e.toDataURL("image/jpeg");e.toBlob(function(e){if(e.size>1048576)suofang(o,t,a);else{var r=parseInt(1e5*Math.random()),s=i.dataURLtoFile(o,r+".jpg");a(e,s)}},"image/jpeg")}}),dataURLtoFile:function(e,t){for(var a=e.split(","),r=a[0].match(/:(.*?);/)[1],i=atob(a[1]),s=i.length,o=new Uint8Array(s);s--;)o[s]=i.charCodeAt(s);return new File([o],t,{type:r})}}}},186:function(e,t,a){t=e.exports=a(170)(),t.push([e.i,".el-icon-plus[data-v-d62cc4e8]{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.el-icon-plus[data-v-d62cc4e8]:hover{border-color:#409eff}.avatar-uploader-icon[data-v-d62cc4e8]{font-size:28px;color:#8c939d;width:60px;height:60px;line-height:60px;text-align:center}.avatar[data-v-d62cc4e8]{width:60px;height:60px;display:block;cursor:pointer}.add[data-v-d62cc4e8]{margin-bottom:20px}",""])},187:function(e,t,a){var r=a(186);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(171)("f44f7f54",r,!0)},188:function(e,t,a){a(187);var r=a(77)(a(184),a(189),"data-v-d62cc4e8",null);e.exports=r.exports},189:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.num}},[e.imaegUrl?a("img",{staticClass:"avatar",attrs:{src:e.imaegUrl},on:{click:e.fileShow}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon",on:{click:e.fileShow}}),e._v(" "),a("input",{staticClass:"hide",attrs:{type:"file",name:"",id:"fileinp"+e.num},on:{change:e.fileChange}})])},staticRenderFns:[]}},219:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(188),i=a.n(r);t.default={data:function(){return{activeName:"first",id:"",imgList:[],image_path:"",markerimg:{},page:1,total:0,sort_num:0,image_card:!1,sort_card:!1,preview_card:!1}},mounted:function(){this.id=this.$route.query.id,this.getpromoteInfo(),this.getPromoteimagedetail()},methods:{handleClick:function(){},showImg:function(){this.image_card=!0,this.image_path=""},hideImg:function(){this.image_card=!1},showSort:function(e){this.image_path=e.image_path,this.sort_num=e.order_by,this.sort_card=!0},hideSort:function(){this.image_path="",this.sort_num="",this.sort_card=!1},showPreview:function(){this.preview_card=!0},hidePreview:function(){this.preview_card=!1},getPromoteimagedetail:function(){var e=this;e.$request({data:{promote_id:e.id},url:"promote/getPromoteimagedetail",success:function(t){e.imgList=t.detail},error:function(){}})},getpromoteInfo:function(){var e=this;e.$request({data:{id:e.id},url:"user/getpromoteinfo",success:function(t){e.markerimg=t.data},error:function(){}})},submitImg:function(){if(!this.markerimg.title)return void this.$message({message:"标题不能为空",type:"error"});this.uploadPromoteImages()},submitSort:function(){if(!this.sort_num)return void this.$message({message:"排序不能为空",type:"error"});this.sortPromoteimagedetail()},sortPromoteimagedetail:function(){var e=this;e.$request({data:{image_path:e.image_path,order_by:e.sort_num},url:"promote/sortPromoteimagedetail",success:function(t){e.sort_card=!1,e.getPromoteimagedetail(),e.$message({message:"修改成功",type:"success"})},error:function(t){var a="";switch(parseInt(t)){case 3001:a="图片不能为空";break;case 3002:a="图片不存在";break;case 3003:a="排序只能为数字且不超过3位数字";break;case 3004:a="上传失败";break;default:a="意料之外的错误"}e.$message({message:a,type:"error"})}})},uploadPromoteImages:function(){var e=this,t=new FormData;t.append("image_type",1),t.append("promote_id",e.id),t.append("images[]",e.image_path),e.$request({data:t,url:"promote/uploadPromoteImages",success:function(t){e.image_card=!1,e.getPromoteimagedetail(),e.$message({message:"添加成功",type:"success"})},error:function(t){var a="";switch(parseInt(t)){case 3001:a="图片类型有误";break;case 3002:a="商品id只能是数字";break;case 3003:a="图片不能空";break;case 3004:a="商品不存在";break;case 3005:a="图片没有上传过";break;case 3006:a="上传失败";break;default:a="意料之外的错误"}e.$message({message:a,type:"error"})}})},submitForm:function(){return this.markerimg.title?this.markerimg.share_title?void this.editpromote():void this.$message({message:"分享标题不能为空",type:"error"}):void this.$message({message:"标题不能为空",type:"error"})},editpromote:function(){var e=this;e.$request({data:e.markerimg,url:"user/editpromote",success:function(t){e.boxcard=!1,e.$message({message:"修改成功",type:"success"}),e.getpromoteInfo()},error:function(t){var a="";switch(parseInt(t)){case 3001:case 3001:a="标题不能为空";break;case 3002:a="分享标题不能为空";break;case 3006:a="活动展示大图图片没有上传过";break;case 3007:a="微信转发分享图片没有上传过";break;case 3008:a="分享成功页面图片没有上传过";break;case 3009:a="分享次数有误";break;case 3010:a="修改失败";break;default:a="意料之外的错误"}e.$message({message:a,type:"error"})}})},delImg:function(e){if(!e)throw new Error("img 未拿到值");var t=this;t.$request({data:{image_path:e},url:"promote/delPromoteImage",success:function(e){t.getPromoteimagedetail(),t.$message({message:"删除成功",type:"success"})},error:function(e){var a="";switch(parseInt(e)){case 3001:a="删除失败";break;default:a="意料之外的错误"}t.$message({message:a,type:"error"})}})},upresult:function(e){"image_path"==e.num?this.image_path=e.image_path:this.markerimg[e.num]=e.image_path}},components:{vUpload:i.a}}},227:function(e,t,a){t=e.exports=a(170)(),t.push([e.i,".btn[data-v-289756e5]{width:200px}.box-card[data-v-289756e5]{margin-top:30px;width:600px}.img-con[data-v-289756e5]{display:block;margin:0 auto}.add[data-v-289756e5]{margin-bottom:20px;cursor:pointer}.el-icon-view[data-v-289756e5]{font-size:18px}.imgpreview[data-v-289756e5]{max-height:600px;overflow:auto}",""])},235:function(e,t,a){var r=a(227);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(171)("71b7c4b3",r,!0)},245:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"editMarketing"}},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"基本信息",name:"first"}},[a("div",{staticClass:"box-card"},[a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"活动标题"}},[a("el-input",{attrs:{placeholder:"请输入活动标题"},model:{value:e.markerimg.title,callback:function(t){e.$set(e.markerimg,"title",t)},expression:"markerimg.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"分享标题"}},[a("el-input",{attrs:{placeholder:"请输入微信分享标题"},model:{value:e.markerimg.share_title,callback:function(t){e.$set(e.markerimg,"share_title",t)},expression:"markerimg.share_title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"活动展示大图"}},[a("v-upload",{attrs:{num:"big_image",image:e.markerimg.big_image},on:{upresult:e.upresult}})],1),e._v(" "),a("el-form-item",{attrs:{label:"微信转发分享图片"}},[a("v-upload",{attrs:{num:"share_image",image:e.markerimg.share_image},on:{upresult:e.upresult}})],1),e._v(" "),a("el-form-item",{staticClass:"flex-cen"},[a("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("保存")])],1)],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"活动详情图",name:"second"}},[a("el-button",{staticClass:"add",attrs:{type:"primary"},on:{click:function(t){return e.showImg()}}},[e._v("添加详情图")]),e._v(" "),a("el-button",{staticClass:"fr add",attrs:{type:"primary"},on:{click:function(t){return e.showPreview()}}},[a("i",{staticClass:"el-icon-view"})]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.imgList,border:""}},[a("el-table-column",{attrs:{type:"index",label:"序号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"image_path",label:"图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("img",{staticClass:"img-con",attrs:{src:e.row.image_path,width:"40"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"order_by",label:"排序"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"上传时间"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.showSort(t.row)}}},[e._v("排序")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.delImg(t.row.image_path)}}},[e._v("删除")])]}}])})],1)],1)],1),e._v(" "),e.image_card?a("div",{staticClass:"suspension"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("图片")])]),e._v(" "),a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"图片"}},[a("v-upload",{attrs:{num:"image_path",image:e.image_path},on:{upresult:e.upresult}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitImg()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){return e.hideImg(!1)}}},[e._v("取消")])],1)],1)],1)],1):e._e(),e._v(" "),e.sort_card?a("div",{staticClass:"suspension"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("排序")])]),e._v(" "),a("el-form",{attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"排序"}},[a("el-input",{attrs:{placeholder:"请输入排序数字"},model:{value:e.sort_num,callback:function(t){e.sort_num=e._n(t)},expression:"sort_num"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitSort()}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){return e.hideSort(!1)}}},[e._v("取消")])],1)],1)],1)],1):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.preview_card,expression:"preview_card"}],staticClass:"suspension"},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("图片预览")])]),e._v(" "),a("el-form",{attrs:{"label-width":"1px"}},[a("el-form-item",{staticClass:"imgpreview",attrs:{label:""}},e._l(e.imgList,function(e,t){return a("el-image",{key:t,staticClass:"elImg fl",attrs:{src:e.image_path}})}),1),e._v(" "),a("el-form-item",{staticClass:"flex-cen"},[a("el-button",{on:{click:function(t){return e.hidePreview()}}},[e._v("取消")])],1)],1)],1)],1)],1)},staticRenderFns:[]}}});